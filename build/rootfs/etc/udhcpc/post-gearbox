#!/bin/bash

DETAILS="/tmp/udhcpc.details"
STATE="/tmp/udhcpc.state"
IP="/tmp/udhcpc.ip"
NAME="/tmp/udhcpc.name"

get_details()
{
	echo -n "$1" > ${STATE}

	echo "DHCP server:${serverid}" > ${DETAILS}
	echo "Router:${router}" >> ${DETAILS}
	echo "DNS:${dns}" >> ${DETAILS}
	echo "Lease time:${lease}" >> ${DETAILS}

	if [ "${ip}" == "" ]
	then
		ip="$(ip addr show eth1 | awk '/inet /{gsub(/\/.*/, "", $2); print$2}')"
	fi
	echo -n "${ip}" > ${IP}

	if [ "${domain}" != "" ]
	then
		echo -n "${HOSTNAME}.${domain}" > ${NAME}
	else
		echo -n "" > ${NAME}
	fi
}


case "$1" in
        deconfig|renew|bound)
		get_details "OK"
                ;;

        leasefail)
                echo "udhcpc failed to get a DHCP lease" >&2
		get_details ""
                ;;

        nak)
                echo "udhcpc received DHCP NAK" >&2
		get_details ""
                ;;

        *)
		if [ ! -s /tmp/udhcpc.ip ]
		then
			ip="$(ip addr show eth1 | awk '/inet /{gsub(/\/.*/, "", $2); print$2}')"
		fi
                ;;
esac


